#!/bin/bash

# --- Configuraci√≥n ---
# Variable para el mensaje de commit

COMMIT_MESSAGE=""

# --- Funciones ---

# Funci√≥n para verificar si estamos en un repositorio Git
check_git_repo() {
    if ! git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
        echo "‚ùå Error: No est√°s en un repositorio Git. Inicializa uno con 'git init' o navega a la carpeta correcta."
        exit 1
    fi
}

# Funci√≥n para manejar los argumentos y solicitar el mensaje
get_commit_message() {
    if [ -n "$1" ]; then
        # Si se pasa un argumento, √∫salo como mensaje
        COMMIT_MESSAGE="$1"
    else
        # Si no hay argumento, solicita el mensaje al usuario
        read -r -p "‚úçÔ∏è Introduce el mensaje del commit: " COMMIT_MESSAGE
    fi

    # Verificar que el mensaje no est√© vac√≠o
    if [ -z "$COMMIT_MESSAGE" ]; then
        echo "‚ùå Error: El mensaje del commit no puede estar vac√≠o. Abortando."
        exit 1
    fi
}

# --- L√≥gica Principal ---
check_git_repo

# Obtener el mensaje del commit
get_commit_message "$1"

echo "----------------------------------------"
echo "ü§ñ Ejecutando commit con mensaje: '$COMMIT_MESSAGE'"
echo "----------------------------------------"

# 1. A√±adir todos los cambios
echo "‚û°Ô∏è  1. A√±adiendo todos los archivos modificados ('git add .')..."
git add .

# 2. Realizar el commit
echo "‚û°Ô∏è  2. Realizando el commit ('git commit')..."
if git commit -m "$COMMIT_MESSAGE"; then
    echo "‚úÖ Commit exitoso."
else
    # Si no hay cambios para commitear, git commit fallar√°, pero no es un error grave.
    if git status | grep -q "nothing to commit"; then
        echo "‚ö†Ô∏è Advertencia: No hay cambios nuevos para commitear. Saltando commit."
    else
        echo "‚ùå Error al realizar el commit. Revisa la salida de git."
        exit 1
    fi
fi

# 3. Enviar los cambios al repositorio remoto
echo "‚û°Ô∏è  3. Empujando los cambios ('git push')..."
if git push; then
    echo "üéâ ¬°Push completado con √©xito! El trabajo est√° en GitHub/GitLab."
else
    echo "‚ö†Ô∏è Advertencia: Fallo al hacer 'git push'. Revisa tus credenciales o conexi√≥n."
fi

echo "----------------------------------------"
